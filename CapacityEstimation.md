# System Design

## Capacity Estimation

Estimations important for large scale system design:

1) Traffic
2) Storage
3) Bandwidth
4) Memory

Doing traffic and storage is good enough for the interview

## 1. Traffic Estimation

Only thing to Ask from interviewer

-  <u>**Daily Active Users (DAU)**</u>

Example: 10M

### Step 1: Convert users to requests.

Because our Server & DB only care about number of requests they have to serve.
A single user can generate multiple interactions with the service (Multiple read and write requests)

<mark>Calculate how many read request and write request can be generated by a single user</mark>


| Metric | Description |
| ----------- | ----------- |
| Write | Make assumption that only 10% of DAU will make a write call. Here 10% of 10M = 1M |
| Read | Text |

In general most service will be <u>**read heavy**</u> because users tend to consume more data than produce it

Now, we can choose a read : write ratio => 10:1 ; 50: 1 ; 100:1 etc.

Let's take 50:1 for now. That means ~50M read calls for 1M write calls

### <u>Step 1</u>: Bring down calculation to per seconds

- ~~Divide by **86400** seconds~~ &rarr; Divide by 100k (Always do approx calculation)


#### Better approximations to memorize:

| Million/Day|  |
| ----------- | ----------- |
| 1 million / day | 12 / sec |
| 1 million / day | 700 / min |
| 1 million / day | 4200 / hour |

#### Final data:
<mark> **Writes** ~ 10 /sec </mark>

<mark> **Reads** ~ 500 / sec</mark>


---

## 2. Storage

We have to estimate how much data we have to store at any given moment

(Only ballpark estimation)

Example: For PASTEBIN

- Storage needed for: Paste and URL 

- Size of URL significantly smaller than the paste so its better to focus only on the paste

### <u>Calculation</u>:

We can say that users generally use paste services to share code snippets, logs etc. Hence &rarr;
- 1 paste &rarr; Approx. 200 lines
- 1 Line &rarr; 10 words
- 1 word &rarr; 5 characters
- 1 character &rarr; 1 Byte

Total = 200 x 10 x 5 = 10000 Byte ~ **10 kB**

New data per day = write request/day X size of 1 paste

| Memory|  | Conversion |
| ----------- | ----------- | ----------- |
| Kilo | Thousand | 10<sup>3</sup> |
| Mega | Million | 10<sup>6</sup> |
| Giga | Billion | 10<sup>9</sup> |
| Tera | Trillion | 10<sup>12</sup> |
| Peta | Quadrillion | 10<sup>15</sup> |

For easier calculation just replace 10 power with first column

<u>In our case</u>: 

<mark > 1M X 10 X 1000 Byte &rarr; 10<sup>10</sup> &rarr; 10 GB per day</mark>

In this case for Pastebin, we can also consider retention period ~ 5 years

10 GB * ~~365~~ 400 * 5 = 20k GB ~ 20 TB

### <u>Replication</u>:

Good practice to replicate the data for backup and to improve availability and performance.

Common to replicate data 3-5 times

Hence, in total we are going to need = 3 X 20 

<mark>= 60TB </mark>

That's all we need for storage estimation


---
## 3. Bandwidth

It is the amount of data transferred per second

We need to compute:

- Incoming data per second (Write)
- Outgoing data per second (Read)

### <u>Incoming data per second</u>:

Write frequency X average data size of 1 paste = 10 * 10 kB = 100 kB per second

### <u>Outgoing data per second</u>:

Read frequency = 50 X Write = 5 MB


















 